<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>主页</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            text-align: center; /* Add this line */
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .post {
            background-color: #fff;
            padding: 20px;
            margin: 20px auto;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 38%;
            min-width: 500px; /* Add this line */
        }
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            justify-content: center; /* Change this line */
        }
        .post-content {
            background-color: #f8f8f8;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>搜索</h1>
    <form action="" method="POST">
        <input type="text" name="search" placeholder="搜索">
        <input type="submit" value="搜索">
        <a href="write_blog.php" style="margin-left: 10px;">写帖子</a>
    </form>
<?php
    // 连接到数据库
    $mysqli = new mysqli('localhost', 'zenghao', '03210830', 'sq1x5s');
    if ($mysqli->connect_error) {
        die('Connect Error (' . $mysqli->connect_errno . ') ' . $mysqli->connect_error);
    }

    // 检查是否提交了搜索表单
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        // 用户提交了搜索表单，执行搜索查询
        $search = $mysqli->real_escape_string($_POST['search']);
        $sql = "SELECT blog.title, blog.content, blog.created_at, user.username FROM blog JOIN user ON blog.user_id = user.uid WHERE blog.title LIKE '%$search%' OR blog.content LIKE '%$search%' OR user.username LIKE '%$search%'";
    } else {
        // 用户没有提交搜索表单，执行默认查询
        $sql = "SELECT blog.title, blog.content, blog.created_at, user.username FROM blog JOIN user ON blog.user_id = user.uid";
    }

    // 执行查询
    $result = $mysqli->query($sql);
    if ($result->num_rows > 0) {
        // 输出查询结果
        while($row = $result->fetch_assoc()) {
            echo "<div class='post'>";
            echo "<div class='post-header'>";
            echo "<p><strong>用户：</strong>" . $row['username'] . "</p>";
            echo "<p style='color: #888;'><strong>时间：</strong>" . $row['created_at'] . "</p>";
            echo "</div>";
            echo "<div class='post-content'>" . $row['content'] . "</div>";
            echo "</div>";
        }
    } else {
        echo "没有找到帖子";
    }

    // 关闭数据库连接
    $mysqli->close();
?>
</body>
</html>
<!-- <script>alert("xss attack")</script> -->

